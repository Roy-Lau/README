(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{343:function(s,v,_){"use strict";_.r(v);var t=_(1),a=Object(t.a)({},(function(){var s=this,v=s.$createElement,_=s._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[_("h1",{attrs:{id:"mongodb-复制（副本集）"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-复制（副本集）"}},[s._v("#")]),s._v(" MongoDB 复制（副本集）")]),s._v(" "),_("p",[_("RouterLink",{attrs:{to:"/data-base/mongodb/"}},[s._v("目录")])],1),s._v(" "),_("blockquote",[_("p",[s._v("MongoDB复制是将数据同步在多个服务器的过程。")])]),s._v(" "),_("blockquote",[_("p",[s._v("复制提供了数据的冗余备份，并在多个服务器上存储数据副本，提高了数据的可用性，并可以保证数据的安全性。")])]),s._v(" "),_("blockquote",[_("p",[s._v("复制还允许您从硬件故障和服务中断中恢复数据。")])]),s._v(" "),_("p",[_("strong",[s._v("什么是复制?")])]),s._v(" "),_("ul",[_("li",[s._v("保障数据的安全性")]),s._v(" "),_("li",[s._v("数据高可用性 "),_("code",[s._v("(24*7)")])]),s._v(" "),_("li",[s._v("灾难恢复")]),s._v(" "),_("li",[s._v("无需停机维护（如备份，重建索引，压缩）")]),s._v(" "),_("li",[s._v("分布式读取数据")])]),s._v(" "),_("h4",{attrs:{id:"mongodb复制原理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mongodb复制原理"}},[s._v("#")]),s._v(" MongoDB复制原理")]),s._v(" "),_("blockquote",[_("p",[s._v("mongodb的复制至少需要两个节点。其中一个是主节点，负责处理客户端请求，其余的都是从节点，负责复制主节点上的数据。")])]),s._v(" "),_("blockquote",[_("p",[s._v("mongodb各个节点常见的搭配方式为：一主一从、一主多从。")])]),s._v(" "),_("blockquote",[_("p",[s._v("主节点记录在其上的所有操作oplog，从节点定期轮询主节点获取这些操作，然后对自己的数据副本执行这些操作，从而保证从节点的数据与主节点一致。")])]),s._v(" "),_("p",[s._v("MongoDB复制结构图如下所示：")]),s._v(" "),_("img",{attrs:{src:"imgs/replication.png",alt:"MongoDB复制原理图"}}),s._v(" "),_("p",[s._v("以上结构图中，客户端从主节点读取数据，在客户端写入数据到主节点时， 主节点与从节点进行数据交互保障数据的一致性。")]),s._v(" "),_("p",[s._v("副本集特征：")]),s._v(" "),_("ul",[_("li",[s._v("N 个节点的集群")]),s._v(" "),_("li",[s._v("任何节点可作为主节点")]),s._v(" "),_("li",[s._v("所有写入操作都在主节点上")]),s._v(" "),_("li",[s._v("自动故障转移")]),s._v(" "),_("li",[s._v("自动恢复")])]),s._v(" "),_("h4",{attrs:{id:"mongodb副本集设置"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mongodb副本集设置"}},[s._v("#")]),s._v(" MongoDB副本集设置")]),s._v(" "),_("p",[s._v("1、关闭正在运行的MongoDB服务器。")]),s._v(" "),_("p",[s._v("现在我们通过指定 "),_("code",[s._v("--replSet")]),s._v(" 选项来启动mongoDB。"),_("code",[s._v("--replSet")]),s._v(" 基本语法格式如下：")]),s._v(" "),_("div",{staticClass:"language-bash line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[s._v("mongod --port "),_("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PORT"')]),s._v(" --dbpath "),_("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YOUR_DB_DATA_PATH"')]),s._v(" --replSet "),_("span",{pre:!0,attrs:{class:"token string"}},[s._v('"REPLICA_SET_INSTANCE_NAME"')]),s._v("\n")])]),s._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[s._v("1")]),_("br")])]),_("p",[s._v("实例")]),s._v(" "),_("div",{staticClass:"language-bash line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[s._v("mongod --port "),_("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v(" --dbpath "),_("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\set up\\mongodb\\data"')]),s._v(" --replSet rs0\n")])]),s._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[s._v("1")]),_("br")])]),_("p",[s._v("以上实例会启动一个名为"),_("code",[s._v("rs0")]),s._v("的"),_("code",[s._v("MongoDB")]),s._v("实例，其端口号为"),_("code",[s._v("27017")]),s._v("。")]),s._v(" "),_("p",[s._v("启动后打开命令提示框并连接上"),_("code",[s._v("mongoDB")]),s._v("服务。")]),s._v(" "),_("p",[s._v("在"),_("code",[s._v("Mongo")]),s._v("客户端使用命令"),_("code",[s._v("rs.initiate()")]),s._v("来启动一个新的副本集。")]),s._v(" "),_("p",[s._v("我们可以使用"),_("code",[s._v("rs.conf()")]),s._v("来查看副本集的配置")]),s._v(" "),_("p",[s._v("查看副本集状态使用 "),_("code",[s._v("rs.status()")]),s._v(" 命令")]),s._v(" "),_("h4",{attrs:{id:"副本集添加成员"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#副本集添加成员"}},[s._v("#")]),s._v(" 副本集添加成员")]),s._v(" "),_("p",[s._v("添加副本集的成员，我们需要使用多台服务器来启动"),_("code",[s._v("mongo")]),s._v("服务。进入"),_("code",[s._v("Mongo")]),s._v("客户端，并使用"),_("code",[s._v("rs.add()")]),s._v("方法来添加副本集的成员。")]),s._v(" "),_("p",[s._v("语法\n"),_("code",[s._v("rs.add()")]),s._v(" 命令基本语法格式如下：")]),s._v(" "),_("div",{staticClass:"language-sh line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-sh"}},[_("code",[_("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("rs.add"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HOST_NAME:PORT"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[s._v("1")]),_("br")])]),_("p",[s._v("实例")]),s._v(" "),_("p",[s._v("假设你已经启动了一个名为"),_("code",[s._v("mongod1.net")]),s._v("，端口号为"),_("code",[s._v("27017")]),s._v("的"),_("code",[s._v("Mongo")]),s._v("服务。 在客户端命令窗口使用"),_("code",[s._v("rs.add()")]),s._v(" 命令将其添加到副本集中，命令如下所示：")]),s._v(" "),_("div",{staticClass:"language-sh line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-sh"}},[_("code",[_("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("rs.add"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),_("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mongod1.net:27017"')]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[s._v("1")]),_("br")])]),_("p",[_("code",[s._v("MongoDB")]),s._v("中你只能通过主节点将"),_("code",[s._v("Mongo")]),s._v("服务添加到副本集中， 判断当前运行的"),_("code",[s._v("Mongo")]),s._v("服务是否为主节点可以使用命令"),_("code",[s._v("db.isMaster()")]),s._v(" 。")]),s._v(" "),_("p",[_("code",[s._v("MongoDB")]),s._v("的副本集与我们常见的主从有所不同，主从在主机宕机后所有服务将停止，而副本集在主机宕机后，副本会接管主节点成为主节点，不会出现宕机的情况。")]),s._v(" "),_("p",[_("a",{staticStyle:{float:"right"},attrs:{href:"sharding"}},[s._v("MongoDB 分片")])])])}),[],!1,null,null,null);v.default=a.exports}}]);